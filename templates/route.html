<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Route Distances and Fuel Stations</title>
    
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        h1 {
            color: #333;
        }
        ul {
            list-style-type: none;
            padding: 0;
            width: 100%;
            max-width: 600px;
        }
        li {
            background-color: #fff;
            padding: 20px;
            margin-bottom: 10px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }
        li:hover {
            transform: scale(1.02);
        }
        .info-card {
            background-color: #fff;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .highlight {
            color: #d9534f; /* Highlight color */
            font-weight: bold;
            font-size: 1.2em;
        }
        #map {
            height: 500px;
            width: 100%;
            margin-bottom: 20px;
            position: relative;
        }
        .back-button {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            margin-top: 20px;
            text-decoration: none;
        }
        .back-button:hover {
            background-color: #0056b3;
        }
        button {
            background-color: #5cb85c;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
        }
        button:hover {
            background-color: #4cae4c;
        }
        .legend {
            display: flex;
            flex-direction: column;
            gap: 10px;
            font-weight: bold;
            background-color: white;
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
            position: absolute;
            bottom: 20px;
            left: 20px;
            z-index: 9999;
            width: 250px;
            pointer-events: auto;
        }
        .legend-item {
            background-color: #fff;
            padding: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 5px;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .legend-item:hover {
            background-color: #f1f1f1;
        }
        .color-box {
            width: 20px;
            height: 20px;
            margin-right: 10px;
        }
        .gm-style .legend {
            z-index: 9999;
        }
    </style>

    <script>
        let routeRenderers = [];

        function initMap() {
            const originLat = {{ origin_lat }};
            const originLng = {{ origin_lng }};
            const destinationLat = {{ destination_lat }};
            const destinationLng = {{ destination_lng }};

            const map = new google.maps.Map(document.getElementById("map"), {
                zoom: 11,
                center: { lat: (originLat + destinationLat) / 2, lng: (originLng + destinationLng) / 2 },
                styles: [
                    {
                        "featureType": "all",
                        "elementType": "geometry",
                        "stylers": [{ "visibility": "simplified" }]
                    },
                    {
                        "featureType": "poi",
                        "stylers": [{ "visibility": "off" }]
                    },
                    {
                        "featureType": "water",
                        "elementType": "geometry",
                        "stylers": [{ "color": "#d7e1f2" }]
                    },
                    {
                        "featureType": "landscape",
                        "elementType": "geometry",
                        "stylers": [{ "color": "#f5f5f5" }]
                    },
                ]
            });

            const directionsService = new google.maps.DirectionsService();
            const colors = ['#FF0000', '#0000FF', '#00FF00', '#FFA500', '#800080'];

            const request = {
                origin: { lat: originLat, lng: originLng },
                destination: { lat: destinationLat, lng: destinationLng },
                travelMode: google.maps.TravelMode.DRIVING,
                provideRouteAlternatives: true,
            };

            directionsService.route(request, (result, status) => {
                if (status === google.maps.DirectionsStatus.OK) {
                    result.routes.forEach((route, index) => {
                        const directionsRenderer = new google.maps.DirectionsRenderer({
                            map: map,
                            suppressMarkers: false,
                            polylineOptions: {
                                strokeColor: colors[index % colors.length],
                                strokeOpacity: 0.7,
                                strokeWeight: 5
                            },
                            preserveViewport: true,
                        });
                        directionsRenderer.setDirections(result);
                        directionsRenderer.setRouteIndex(index);
                        
                        routeRenderers.push(directionsRenderer);
                    });

                    addMarkers(map, originLat, originLng, destinationLat, destinationLng);
                } else {
                    console.error('Error fetching directions: ' + status);
                }
            });
        }

        function addMarkers(map, originLat, originLng, destinationLat, destinationLng) {
            new google.maps.Marker({
                position: { lat: originLat, lng: originLng },
                map: map,
                label: 'O',
                title: 'Origin'
            });

            new google.maps.Marker({
                position: { lat: destinationLat, lng: destinationLng },
                map: map,
                label: 'D',
                title: 'Destination'
            });
        }

        function highlightRoute(index) {
            routeRenderers.forEach(renderer => {
                renderer.setOptions({ polylineOptions: { strokeOpacity: 0.3 } });
            });
            routeRenderers[index].setOptions({ polylineOptions: { strokeOpacity: 1.0 } });
        }
    </script>

    <!-- Load Google Maps API -->
    <script src="https://maps.googleapis.com/maps/api/js?key={{ google_maps_api_key }}&callback=initMap" async defer></script>
</head>
<body>
    <h1>Route Distances and Fuel Stations</h1>

    <!-- Map container to display the routes -->
    <div id="map">
        <!-- Legend placed inside the map -->
        <div class="legend">
            {% for route in routes %}
            <div class="legend-item" onmouseover="highlightRoute({{ loop.index0 }})">
                <div class="color-box" style="background-color: {{ colors[loop.index0 % colors | length] }}"></div>
                <div>
                    <strong>Route {{ loop.index }}:</strong> {{ route.duration | round(1) }} mins, {{ route.distance | round(1) }} km, {{ route.fuel_cost | round(2) }} AUD
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Route details displayed below the legend -->
    <ul>
        {% for route in routes %}
        <li onmouseover="highlightRoute({{ loop.index0 }})">
            <h3>Route {{ loop.index }}:</h3>
            <div class="info-card">
                <div>
                    <p><strong>Distance:</strong> {{ route.distance | round(1) }} km</p>
                    <p><strong>Estimated Time:</strong> <span class="highlight">{{ route.duration | round(1) }} mins</span></p>
                </div>
                <div>
                    <p><strong>Fuel Consumption:</strong> {{ route.fuel_consumption | round(2) }} L</p>
                    <p><strong>Fuel Cost:</strong> <span class="highlight">{{ route.fuel_cost | round(2) }} AUD</span></p>
                </div>
            </div>
            <button onclick="openGoogleMapsNavigation('{{ origin }}', null, '{{ destination }}')">Select Route {{ loop.index }}</button>
        </li>
        {% endfor %}
    </ul>

    <!-- Back button -->
    <a href="/" class="back-button">Back to Route Finder</a>
</body>
</html>